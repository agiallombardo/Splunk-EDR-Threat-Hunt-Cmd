<?xml version="1.0"?>
<setup>
  <block title="TA-EDR_Threat_Hunt_Cmd Setup" endpoint="admin/TA-EDR_Threat_Hunt_Cmd" entity="ta_edrhunt_settings">
    <text>This page helps you configure the EDR Hunt app for Splunk. Enter the required API credentials and settings for each provider.</text>
    
    <input field="enable_logging">
      <label>Enable Detailed Logging</label>
      <type>bool</type>
      <tooltip>Turn on detailed logging for troubleshooting. Log files will be stored in $SPLUNK_HOME/var/log/splunk/</tooltip>
    </input>
    
    <input field="log_level">
      <label>Log Level</label>
      <type>select</type>
      <options>
        <opt value="INFO">INFO</opt>
        <opt value="DEBUG">DEBUG</opt>
        <opt value="WARNING">WARNING</opt>
        <opt value="ERROR">ERROR</opt>
      </options>
      <default>INFO</default>
      <tooltip>Select the logging level. DEBUG provides the most detailed information.</tooltip>
    </input>
    
    <input field="default_threads">
      <label>Default Thread Count</label>
      <type>text</type>
      <default>4</default>
      <tooltip>Number of threads to use for parallel processing (1-16).</tooltip>
    </input>
    
    <input field="default_batch_size">
      <label>Default Batch Size</label>
      <type>text</type>
      <default>20</default>
      <tooltip>Number of records to process in each batch.</tooltip>
    </input>
    
    <tab title="CrowdStrike Configuration">
      <input field="crowdstrike_enabled">
        <label>Enable CrowdStrike Integration</label>
        <type>bool</type>
        <default>true</default>
        <tooltip>Enable or disable the CrowdStrike integration.</tooltip>
      </input>
      
      <input field="crowdstrike_max_rate">
        <label>API Rate Limit (Requests per Minute)</label>
        <type>text</type>
        <default>120</default>
        <tooltip>Maximum requests per minute to send to the CrowdStrike API.</tooltip>
      </input>
      
      <input field="crowdstrike_api_timeout">
        <label>API Timeout (Seconds)</label>
        <type>text</type>
        <default>30</default>
        <tooltip>Timeout in seconds for API requests.</tooltip>
      </input>
      
      <table title="CrowdStrike Credentials">
        <header>Configure CrowdStrike API credentials for each tenant and console. Use the format: crowdstrike_&lt;tenant&gt;_&lt;console&gt;</header>
        <input field="crowdstrike_credentials_list">
          <label>Credentials List</label>
          <type>text</type>
          <placeholder>crowdstrike_default_primary,crowdstrike_corporate_us</placeholder>
          <tooltip>Comma-separated list of credential names to create.</tooltip>
        </input>
      </table>
    </tab>
    
    <tab title="SentinelOne Configuration">
      <input field="sentinelone_enabled">
        <label>Enable SentinelOne Integration</label>
        <type>bool</type>
        <default>true</default>
        <tooltip>Enable or disable the SentinelOne integration.</tooltip>
      </input>
      
      <input field="sentinelone_max_rate">
        <label>API Rate Limit (Requests per Minute)</label>
        <type>text</type>
        <default>60</default>
        <tooltip>Maximum requests per minute to send to the SentinelOne API.</tooltip>
      </input>
      
      <input field="sentinelone_api_timeout">
        <label>API Timeout (Seconds)</label>
        <type>text</type>
        <default>30</default>
        <tooltip>Timeout in seconds for API requests.</tooltip>
      </input>
      
      <table title="SentinelOne Credentials">
        <header>Configure SentinelOne API credentials for each tenant and console. Use the format: sentinelone_&lt;tenant&gt;_&lt;console&gt;</header>
        <input field="sentinelone_credentials_list">
          <label>Credentials List</label>
          <type>text</type>
          <placeholder>sentinelone_default_primary,sentinelone_emea_primary</placeholder>
          <tooltip>Comma-separated list of credential names to create.</tooltip>
        </input>
      </table>
    </tab>
    
    <tab title="Microsoft Defender Configuration">
      <input field="defender_enabled">
        <label>Enable Microsoft Defender Integration</label>
        <type>bool</type>
        <default>true</default>
        <tooltip>Enable or disable the Microsoft Defender integration.</tooltip>
      </input>
      
      <input field="defender_max_rate">
        <label>API Rate Limit (Requests per Minute)</label>
        <type>text</type>
        <default>100</default>
        <tooltip>Maximum requests per minute to send to the Microsoft Defender API.</tooltip>
      </input>
      
      <input field="defender_api_timeout">
        <label>API Timeout (Seconds)</label>
        <type>text</type>
        <default>30</default>
        <tooltip>Timeout in seconds for API requests.</tooltip>
      </input>
      
      <table title="Microsoft Defender Credentials">
        <header>Configure Microsoft Defender API credentials for each tenant and console. Use the format: defender_&lt;tenant&gt;_&lt;console&gt;</header>
        <input field="defender_credentials_list">
          <label>Credentials List</label>
          <type>text</type>
          <placeholder>defender_default_primary,defender_corporate_global</placeholder>
          <tooltip>Comma-separated list of credential names to create.</tooltip>
        </input>
      </table>
    </tab>
    
    <tab title="Tenant Configuration">
      <text>Configure tenants for multi-tenant environments. Each tenant can have multiple consoles for different EDR providers.</text>
      
      <table title="Tenants">
        <header>Define tenants for your environment.</header>
        <input field="tenant_list">
          <label>Tenant List</label>
          <type>text</type>
          <placeholder>default,corporate,emea,apac</placeholder>
          <tooltip>Comma-separated list of tenant IDs.</tooltip>
        </input>
      </table>
    </tab>
    
    <tab title="KV Store Configuration">
      <input field="kvstore_collection">
        <label>KV Store Collection Name</label>
        <type>text</type>
        <default>edr_agents</default>
        <tooltip>Name of the KV Store collection to use for agent data.</tooltip>
      </input>
      
      <input field="agent_ttl">
        <label>Agent TTL (Days)</label>
        <type>text</type>
        <default>7</default>
        <tooltip>Time-to-live in days for agent records. Agents not updated within this period will be removed.</tooltip>
      </input>
      
      <input field="backup_to_csv">
        <label>Backup Agents to CSV</label>
        <type>bool</type>
        <default>true</default>
        <tooltip>Periodically backup agent data to CSV for redundancy.</tooltip>
      </input>
    </tab>
    
    <tab title="Health Monitoring">
      <text>Configure health monitoring for your EDR integration.</text>
      
      <input field="enable_health_monitoring">
        <label>Enable Health Monitoring</label>
        <type>bool</type>
        <default>true</default>
        <tooltip>Enable automated health monitoring for EDR integration.</tooltip>
      </input>
      
      <input field="health_check_interval">
        <label>Health Check Interval (Hours)</label>
        <type>text</type>
        <default>24</default>
        <tooltip>How often to run automated health checks (in hours).</tooltip>
      </input>
      
      <input field="health_results_collection">
        <label>Health Results Collection</label>
        <type>text</type>
        <default>edr_health_results</default>
        <tooltip>KV Store collection name for health check results.</tooltip>
      </input>
      
      <input field="health_retention_days">
        <label>Health Results Retention (Days)</label>
        <type>text</type>
        <default>30</default>
        <tooltip>How long to keep health check results in KV Store (in days).</tooltip>
      </input>
      
      <input field="alert_on_degradation">
        <label>Alert on Health Degradation</label>
        <type>bool</type>
        <default>true</default>
        <tooltip>Send alerts when health status degrades.</tooltip>
      </input>
      
      <input field="alert_email">
        <label>Alert Email Recipients</label>
        <type>text</type>
        <default>security-admins@example.com</default>
        <tooltip>Email addresses to receive health alerts (comma-separated).</tooltip>
      </input>
    </tab>
  </block>
</setup>
