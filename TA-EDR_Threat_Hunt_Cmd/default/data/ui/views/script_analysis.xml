<?xml version="1.1" encoding="UTF-8"?>
<dashboard version="1.1" theme="dark" stylesheet="edr_dashboard.css">
  <label>EDR Script Analysis</label>
  <description>Script execution information from EDR agents</description>
  
  <fieldset submitButton="true" autoRun="false">
    <input type="dropdown" token="tenant_param">
      <label>Tenant</label>
      <search>
        <query> <![CDATA[
          | inputlookup edr_agents
          | stats count by tenant
          | sort tenant
        ]]></query>
      </search>
      <fieldForLabel>tenant</fieldForLabel>
      <fieldForValue>tenant</fieldForValue>
      <default>default</default>
      <choice value="">All Tenants</choice>
    </input>
    
    <input type="dropdown" token="provider_param">
      <label>Provider</label>
      <choice value="crowdstrike">CrowdStrike</choice>
      <choice value="sentinelone">SentinelOne</choice>
      <choice value="defender">Microsoft Defender</choice>
      <default>crowdstrike</default>
    </input>
    
    <input type="dropdown" token="time_range_param">
      <label>Time Range</label>
      <choice value="1h">1 hour</choice>
      <choice value="6h">6 hours</choice>
      <choice value="12h">12 hours</choice>
      <choice value="24h">24 hours</choice>
      <choice value="3d">3 days</choice>
      <choice value="7d">7 days</choice>
      <default>24h</default>
    </input>
    
    <input type="text" token="query_param" searchWhenChanged="false">
      <label>Query Filter (Provider-specific syntax)</label>
      <default></default>
      <initialValue></initialValue>
    </input>
    
    <input type="multiselect" token="os_platform_token" searchWhenChanged="false">
      <label>OS Platform</label>
      <search>
        <query> <![CDATA[
          | inputlookup edr_agents
          | stats count by os_platform
          | sort os_platform
        ]]></query>
      </search>
      <fieldForLabel>os_platform</fieldForLabel>
      <fieldForValue>os_platform</fieldForValue>
      <delimiter> OR </delimiter>
      <valueSuffix>"</valueSuffix>
      <valuePrefix>os_platform="</valuePrefix>
      <default>*</default>
      <choice value="*">All</choice>
    </input>
    
    <input type="text" token="hostname_token" searchWhenChanged="false">
      <label>Hostname (regex)</label>
      <default>*</default>
      <prefix>hostname="</prefix>
      <suffix>"</suffix>
    </input>
    
    <input type="dropdown" token="limit_token">
      <label>Maximum Agents to Query</label>
      <choice value="10">10</choice>
      <choice value="20">20</choice>
      <choice value="50">50</choice>
      <default>10</default>
    </input>
    
    <input type="dropdown" token="threads_param">
      <label>Threads</label>
      <choice value="1">1</choice>
      <choice value="2">2</choice>
      <choice value="4">4</choice>
      <choice value="8">8</choice>
      <default>4</default>
    </input>
  </fieldset>

  <row>
    <panel>
      <html>
        <div id="statusBar" class="edr-status-bar">
          <div class="status-message">Ready to execute search</div>
          <div class="status-progress">
            <div class="progress-bar"></div>
          </div>
        </div>
 

  <row>
    <panel>
      <title>Execution Summary</title>
      <single>
        <search>
          <query> <![CDATA[
            | inputlookup edr_agents
            | search 
              $os_platform_token$
              $hostname_token$
            | head $limit_token$
            | stats count as "Agent Count"
          ]]></query>
        </search>
        <option name="drilldown">none</option>
        <option name="rangeColors">["0x53a051", "0x0877a6", "0xf8be34", "0xf1813f", "0xdc4e41"]</option>
        <option name="underLabel">Agents Selected</option>
        <option name="colorBy">value</option>
      </single>
    </panel>
  